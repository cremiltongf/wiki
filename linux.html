---
title:  "Linux - Wiki"
permalink: /linux/
load_js: load_assets_js
---

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{ page.title }}</title>
    {% include head.html %}
</head>
<body id="topo" class="menu-mobile">
    {% include header.html %}
    <p class="btn-container show-btn"><a href="#" class="toggle-menu btn-menu">Sumário</a></p>
    <main class="conteudo-container">
        <aside class="sidebar">
            <menu class="menu">
                <p class="hidden-btn"><a href="#" class="toggle-menu btn-menu">Fechar Sumário</a></p>
                {% include menu-linux.html %}
            </menu>
        </aside>
        <article class="conteudo">

            <blockquote class="info">A fim de otimizar a criação de imagem, o Linux será disponibilizado através do Oracle VirtualBox. Os labs deixarão de ser dual-boot.</blockquote>
            
            <h1>Imagem Linux</h1>
            
            <blockquote class="info">
            Instale o Linux Ubuntu 20.04 LTS no modo UEFI e com instalação mínima.
            </blockquote>

            <!--Conteudo instalacao-->
            <h2>Instalação</h2>
            <h3 id="particao">Partiçao SO</h3>
            <table>
                <tr>
                    <th>Descrição</th>
                    <th>Capacidade</th>
                </tr>
                <tr>
                    <td>Linux</td>
                    <td>80GB</td>
                </tr>
                <tr>
                    <td>Nuvem01</td>
                    <td>10GB</td>
                </tr>
                <tr>
                    <td>Windows</td>
                    <td>Restante da capacidade</td>
                </tr>
            </table>

            <blockquote class="info">
            Caso o equipamento possua unidades extras de armazenamento, utilize todo espaço para partição nuvem01 e/ou nuvem02.
            </blockquote>
            
            <h3 id="root">Usuário root</h3>
            <p>Crie o usuário root <b>IFPR</b> com a senha disponível na <a href="https://goo.gl/A3129L">planilha</a>.</p>

            <h3 id="estudante">Usuário estudante</h3>
            <p>Crie a conta de usuário <b>Aluno</b> com a senha <b>aluno123</b> e defina para iniciar automaticamente por essa conta.</p>
            <p>Caso o login automático não funcione, defina manualmente editando <code class="inline">/etc/lightdm/lightdm.conf</code>.</p>
            <div class="highlight">
                <pre>
                    <code>
                    autologin-user=aluno
                    autologin-user-timeout=0
                    </code>
                </pre>
            </div>

            <h3 id="atualizacao">Atualização do SO</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get update -y && sudo apt-get upgrade -y && sudo apt-get dist-upgrade -y
                    </code>
                </pre>
            </div>

            <h3 id="fontes">Repositório dos parceiros da Canonical</h3>
            <img src="../assets/images/pages/canonical.png" alt="Ativando as fontes dos parceiros da Canonical">

            <h3 id="horas">Evitando problemas de horas com Dual Boot</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo timedatectl set-local-rtc 1 --adjust-system-clock
                    </code>
                </pre>                
            </div>

            <h3 id="restricao">Restringindo o acesso a partições</h3>
            <p>Com essa configuração, apenas root pode montar as partições do Windows.</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo vi /var/lib/polkit-1/localauthority/10-vendor.d/com.ubuntu.desktop.pkla
                    </code>
                </pre>                
            </div>
            <p>Na quarta linha do arquivo altere <code class="inline">ResultActive=yes</code> para <code class="inline">ResultActive=auth_admin_keep</code>.</p>

            <!--Fim conteudo instalacao-->

            <!--Conteudo configuracoes-->
            <h2>Configurações</h2>

            <blockquote class="info">
            Configure todos os computadores para usar armazenamento no modo AHCI, habilite suporte a virtualização, desative Fast Boot/Secure Boot e ative o PXE no modo legado.
            </blockquote>

            <blockquote class="info">Se aplica a todos os usuários.</blockquote>

            <h3 id="tela">Remoção de proteção e bloqueio de tela</h3>
            <img src="../assets/images/pages/bloqueio.png" alt="Remoção de proteção de tela e bloqueio">

            <h3 id="wallpaper">Papel de parede padrão IFPR</h3>
            <p>Faça o <a href="https://drive.google.com/drive/folders/1mFNMKCBx6tvJaPfzSgax-0t9ZrwJIsPn?usp=sharing">download do wallpaper</a>.</p>

            <h4>Instalando Dconf-editor</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install dconf-editor
                    </code>
                </pre>                
            </div>

            <h4>Configurações pelo terminal</h4>
            <blockquote class="info">
                A configuração via dconf facilita atualizações futuras.
            </blockquote>

            <p>Crie o arquivo <code class="inline">user</code> em <code class="inline">/etc/dconf/profile</code> e adicione:</p>
            <div class="highlight">
                <pre>
                    <code>
                    #/etc/dconf/profile/user
                    user-db:user
                    system-db:tema
                    </code>
                </pre>                
            </div>

            <p>Crie o arquivo <code class="inline">00_tema_settings</code> em <code class="inline">/etc/dconf/db/tema.d</code> e adicione:</p>
            <div class="highlight">
                <pre>
                    <code>
                    #/etc/dconf/db/tema.d/00_tema_settings
                    [org/gnome/desktop/background]
                    picture-uri='file:///home/aluno/Imagens/wallpaper.jpg'
                    </code>
                </pre>                
            </div>

            <h4>Bloqueando a troca do papel de parede</h4>
            <p>Crie o arquivo <code class="inline">00_wallpaper</code> em <code class="inline">/etc/dconf/db/tema.d/locks</code> e adicione:</p>
            <div class="highlight">
                <pre>
                    <code>
                    #/etc/dconf/db/tema.d/locks/00_wallpaper
                    /org/gnome/desktop/background/picture-uri
                    </code>
                </pre>
            </div>

            <h4>Aplicando alterações</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo dconf update
                    </code>
                </pre>
            </div>
            <p>Para mais detalhes sobre essas configurações acesse o <a href="https://wiki.gnome.org/Projects/dconf/SystemAdministrators">Wiki do Gnome</a>.</p>

            <h3 id="historico">Histórico do Chrome e Firefox</h3>
            <p>Não é legal deixar históricos de downloads e etc.</p>

            <h3 id="proxy">Configuração de Proxy</h3>
            
            <h4>Pelo terminal</h4>
            <p>Edite o arquivo <code class="inline">/etc/environment</code> e adicione o seguinte conteúdo:</p>
            <div class="highlight">
            <pre>
                <code>
                #for all users
                export http_proxy="http://192.168.0.6:3128/"
                export https_proxy="http://192.168.0.6:3128/"
                export ftp_proxy="http://192.168.0.6:3128/"
                export no_proxy="localhost, 127.0.0.1"

                #for curl
                export HTTP_PROXY="http://192.168.0.6:3128/"
                export HTTPS_PROXY="http://192.168.0.6:3128/"
                export FTP_PROXY="http://192.168.0.6:3128/"
                export NO_PROXY="localhost, 127.0.0.1"
                </code>
            </pre>
            </div>
            
            <h4>Para o APT</h4>
            <p>Para o <code class="inline">apt-get</code>, crie o arquivo <code class="inline">/etc/apt/apt.conf.d/80proxy</code>
            com o seguinte conteúdo:</p>
            <div class="highlight">
            <pre>
                <code>
                Acquire::http::proxy "http://192.168.0.6:3128/";
                Acquire::https::proxy "http://192.168.0.6:3128/";
                Acquire::ftp::proxy "ftp://192.168.0.6:3128/";
                </code>
            </pre>
            </div>

            <!--Fim conteudo configuracoes-->

            <!--Conteudo aplicacoes-->
            <h2>Aplicações</h2>

            <blockquote class="info">
            Firefox e Evince (leitor de PDF) são instalados junto do Sistema Operacional.
            </blockquote>

            <h3 id="7zip">7-zip</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install p7zip p7zip-full p7zip-rar lzma lzma-dev
                    </code>
                </pre>
            </div>

            <h3 id="chrome">Chrome</h3>
            <p>Faça o download do <a href="https://www.google.com/intl/pt-BR/chrome/?standalone=1">Chrome</a>.</p>

            <h3 id="dconf">Dconf-Editor</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install dconf-editor
                    </code>
                </pre>
            </div>

            <h3 id="flashback">Gnome Session Flashback</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install gnome-session-flashback
                    </code>
                </pre>
            </div>

            <h3 id="tweak">Gnome Tweak Tool</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install gnome-tweak-tool
                    </code>
                </pre>
            </div>

            <h3 id="grub">Grub Customizer</h3>
            <p>Configure o grub para que o computador sempre inicialize automaticamente pelo Windows.</p>
            <h4>Instalando o Grub Customizer</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install grub-customizer
                    </code>
                </pre>         
            </div>

            <h3 id="java">Java JDK 17</h3>
            <p>Faça o <a href="https://drive.google.com/drive/folders/1ep3ja3fJ-dgS9F0AtRa3LGv8XdVNDQXV?usp=sharing">download</a> do arquivo de instalação.</p>
            <p>Crie a pasta de instalação:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo mkdir /usr/lib/jvm
                    </code>
                </pre>                
            </div>
  
            <p>Extraindo os arquivos:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo tar zxvf jdk-17_linux-x64_bin.tar.gz -C /usr/lib/jvm
                    </code>
                </pre>                
            </div>
  
            <p>Link simbólico:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo ln -s /usr/lib/jvm/jdk-17.0.2 /usr/lib/jvm/java-oracle
                    </code>
                </pre>
            </div>
  
            <p>Crie o arquivo <code class="inline">/etc/profile.d/java_var.sh</code> com o seguinte conteúdo:</p>
            <div class="highlight">
                <pre>
                    <code>
                    JAVA_HOME=/usr/lib/jvm/java-oracle
                    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin
                    export JRE_HOME
                    export PATH
                    </code>
                </pre>                
            </div>

            <p>Permissão de execução:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo chmod +x /etc/profile.d/java_var.sh
                    </code>
                </pre>
            </div>

            <p>Para testar:</p>
            <div class="highlight">
                <pre>
                    <code>
                    source /etc/profile.d/java_var.sh
                    java -version
                    javac -version    
                    </code>
                </pre>
            </div>

            <h3 id="lamp">LAMP</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install apache2
                    sudo apt-get install mysql-server
                    sudo apt install php libapache2-mod-php php-mysql
                    </code>
                </pre>
            </div>

            <h4>Definindo senha para MySql</h4>
            <div class="highlight">
                <pre>
                    <code>
                    ###acesse o mysql
                    sudo mysql

                    ###logado no mysql
                    ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'SenhaAqui';
                    flush privileges;
                    exit
                    </code>
                </pre>
            </div>

            <h4>Habilitando escrita de URL</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo a2enmod rewrite
                    </code>
                </pre>                
            </div>
  
            <h4>Permitindo o acesso ao host na LAN</h4>
            <p>Abra o arquivo <code class="inline">/etc/apache2/apache2.conf</code> e encontre o trecho abaixo:</p>
            <div class="highlight">
                <pre>
                    <code>
                    &lt;Directory /var/www/&gt;
                    Options Indexes FollowSymLinks
                    AllowOverride None
                    Require all granted
                    &lt;/Directory&gt;
                    </code>
                </pre>                
            </div>

            <p>Altere para:</p>
            <div class="highlight">
                <pre>
                    <code>
                    &lt;Directory /var/www/&gt;
                    Options Indexes FollowSymLinks
                    AllowOverride All
                    Require all granted
                    </code>
                </pre>
            </div>

            <h4>Permissões para diretório de desenvolvimento</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo chmod -R 777 /var/www/html
                    </code>
                </pre>
            </div>

            <blockquote class="info">
            Não faça isso em ambiente de produção.
            </blockquote>

            <h3 id="libre">LibreOffice</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install libreoffice
                    </code>
                </pre>
            </div>

            <h3 id="ssh">OpenSSH Server</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install openssh-server
                    </code>
                </pre>
            </div>            

            <h3 id="phpadmin">PhpMyAdmin</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install phpmyadmin
                    </code>
                </pre>
            </div>

            <h3 id="smb">Samba Cliente</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install smbclient
                    </code>
                </pre>
            </div>

            <h3 id="timefreeze">Script Time Freeze</h3>
            <p>Isso é um script para manter o ambiente do usuário aluno sempre organizado.</p>
           
            <p>Primeiro crie um perfil ideal, com papel de parede padrão, home dos navegadores e etc.</p>
            <p>Com o perfil criado, vamos fazer um backup para recuperá-lo sempre que necessário:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo mkdir /home/resetuser
                    sudo cp -R /home/aluno/. /home/resetuser
                    </code>
                </pre>
            </div>
            
            <p>Agora criamos um script para fazer o inverso em <code class="inline">/sbin/reset-user</code>, com o seguinte conteúdo:</p>
            <div class="highlight">
                <pre>
                    <code>
                    #!/bin/sh
                    rm -rf /home/aluno
                    mkdir /home/aluno
                    cp -R /home/resetuser/. /home/aluno
                    chown -R aluno /home/aluno
                    </code>
                </pre>                
            </div>

            <p>Permissão de execução:</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo chmod +x /sbin/reset-user
                    </code>
                </pre>                
            </div>
  
            <p>Agora criamos o serviço em <code class="inline">/etc/systemd/system/reset-user.service</code> para rodar o script anterior:</p>
            <div class="highlight">
                <pre>
                    <code>
                    [Unit]
                    Description=Restore user Aluno
                    DefaultDependencies=no
                    Before=shutdown.target reboot.target halt.target
                    
                    [Service]
                    Type=oneshot
                    ExecStart=/sbin/reset-user
                    
                    [Install]
                    WantedBy=halt.target reboot.target shutdown.target
                    </code>
                </pre>                
            </div>
            <p>O serviço acima será executado ao reiniciar ou desligar o SO, restaurando o perfil padrão.</p>

            <h4>Ativando o serviço:</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo systemctl enable reset-user.service
                    </code>
                </pre>                
            </div>

            <h4>Desativando o serviço:</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo systemctl disable reset-user.service
                    </code>
                </pre>                
            </div>

            <h3 id="adicionais">Ubuntu Restricted Extras</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install ubuntu-restricted-extras
                    </code>
                </pre>
            </div>            

            <h3 id="vim">Vim</h3>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt-get install vim
                    </code>
                </pre>
            </div>
  
            <h3 id="veyon">Veyon</h3>
            <p>Para mais informações, acesse a página de desenvolvimento do <a href="https://veyon.io/">Veyon</a>.</p>
            <h4>Instalando dependências</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install g++ libc6-dev make cmake qtbase5-dev qtbase5-private-dev \
                    qtbase5-dev-tools qttools5-dev qttools5-dev-tools \
                    qtdeclarative5-dev qtquickcontrols2-5-dev libfakekey-dev \
                    xorg-dev libxtst-dev libjpeg-dev zlib1g-dev libssl-dev libpam0g-dev \
                    libprocps-dev liblzo2-dev libqca-qt5-2-dev libldap2-dev \
                    libsasl2-dev ninja-build
                    </code>
                </pre>
            </div>
            
            <h4>Instala Veyon Cliente</h4>
            <div class="highlight">
                <pre>
                    <code>
                    sudo apt install veyon-service
                    sudo apt install veyon-configurator
                    </code>
                </pre>
            </div>
            
            <blockquote class="info">
            Para a primeira instalação, defina as configurações iniciais e carregue as chaves de acesso.
            </blockquote>

            <h4>Configuração pelo terminal</h4>
            <p>É possível aplicar configuração em massa através do <code class="inline">veyon cli</code>. Por ele podemos importar o arquivo de <b>configuração.json</b> e <b>chave pública</b>.</p>
            <div class="highlight">
                <pre>
                    <code>
                        USER=aluno
                        JSON=veyon-cliente.json
                        CHAVE=professor_public_key.pem
                        TIPO=public
                        
                        sudo veyon-cli config import /home/$USER/Downloads/Veyon/$JSON
                        
                        sudo veyon-cli authkeys import professor/$TIPO /home/$USER/Downloads/Veyon/Chaves/$CHAVE
                    </code>
                </pre>                
            </div>

            <h3 id="vscode">Visual Studio Code</h3>
            <p>Faça o download do <a href="https://code.visualstudio.com/">Visual Studio Code</a>.</p>

            <!--Fim conteudo aplicacoes-->

            <!-- Clone -->
            <h2>Clone Linux</h2>
            <blockquote class="info">
            Para o processo de clonagem, desabilite FastBoot/Secure Boot e utilize o PXE no modo legado.
            </blockquote>
            <h3 id="hostname">Alterar hostname</h3>
            <p>Altere o nome do computador em <code class="inline">/etc/hostname</code> e <code class="inline">/etc/hosts</code>.</p>
            <div class="highlight">
                <pre>
                    <code>
                    sudo vi /etc/hostname
                    sudo vi /etc/hosts
                    </code>
                </pre>
            </div>

            <p>A nomenclatura é o mesmo utilizado no <a href="https://wiki.cremilton.com/windows/#nome-grupo">Windows</a>, de acordo com cada Laboratório.</p>
            <!-- Fim clone -->            
        </article>
    </main>
    {% include footer.html %}
</body>
</html>